#parse("header.vm")
<div class="container">
    <div id="successBox" class="alert alert-success hidden" role="alert">
        <strong>Well done!</strong> You successfully read this important alert message.
    </div>
    <div id="alertBox" class="alert alert-danger hidden" role="alert">
        <strong>Oh snap!</strong> Change a few things up and try submitting again.
    </div>

    <form class="form-signin" id="settingsForm" method="post">
        <fieldset class="form-group">
            <label for="inputName">Name</label>
            <input type="text" class="form-control" id="inputName" value="${user.name}" placeholder="Name">

            <label for="inputEmail">Email address</label>
            <input type="email" class="form-control" id="inputEmail" value="${user.email}" placeholder="Email Address">
        </fieldset>
        <fieldset class="form-group">
            <h2 class="form-signin-heading">Change password</h2>
            <label for="inputoldpassword">Old password</label>
            <input type="password" class="form-control" id="inputOldPassword" placeholder="Old password" autocomplete="off">

            <label for="inputNewPassword">New password</label>
            <input type="password" class="form-control" id="inputNewPassword" placeholder="New password" autocomplete="off">

            <label for="inputNewPassword_repeat">Repeat new password</label>
            <input type="password" class="form-control" id="inputNewPassword_repeat" placeholder="Repeat new password" autocomplete="off">
        </fieldset>
        <button type="submit" class="btn btn-primary" id="submitButton">Submit</button>
    </form>
    <script type="text/javascript">
        $(document).ready(function () {

            $("#inputNewPassword").on('input', function() {
               checkPasswordMatch();
            });
            $("#inputNewPassword_repeat").on('input', function() {
               checkPasswordMatch();
            });

            function checkPasswordMatch() {
                var newPassword = $("#inputNewPassword").val();
                var newPasswordRepeat = $("#inputNewPassword_repeat").val();
                var same = newPassword === newPasswordRepeat;
                if (!same) {
                    showError("Passwords are not equal");
                }else{
                    removeError();
                }
            }

            var alertBox = $("#alertBox");
            var successBox = $("#successBox");
            var submitBtn = $("#submitButton");

            function removeError() {
                alertBox.addClass("hidden");
                submitBtn.prop("disabled", null);
            }

            function showError(error) {
                successBox.addClass("hidden");
                alertBox.removeClass("hidden");
                alertBox.text(error);
                submitBtn.prop("disabled", "disabled");
            }

            function showErrorNoDisable(error) {
                successBox.addClass("hidden");
                alertBox.removeClass("hidden");
                alertBox.text(error);
            }

            function showSuccess(success) {
                alertBox.addClass("hidden");
                successBox.removeClass("hidden");
                successBox.text(success);
                submitBtn.prop("disabled", null);
            }

            $("#settingsForm").submit(function (e) {

                e.preventDefault();

                var name = $("#inputName").val();
                var email = $("#inputEmail").val();
                var oldPassword = $("#inputOldPassword").val();
                var newPassword = $("#inputNewPassword").val();
                var newPasswordRepeat = $("#inputNewPassword_repeat").val();

                var data = {
                    "name": name,
                    "email": email,
                    "oldPassword": oldPassword,
                    "newPassword": newPassword,
                    "newPasswordRepeat": newPasswordRepeat
                };

                $.ajax({
                    "url": "/settings-rest",
                    "method": "post",
                    "data": data,
                    "success": function (data) {
                        var result = data.result;
                        var message = data.message;
                        if (data.result) {
                            showSuccess(message);
                        } else {
                            showErrorNoDisable(message);
                        }

                    },
                    "error": function (data) {
                        showErrorNoDisable(data)
                    }
                });
            });
        });
    </script>
</div>
#parse("footer.vm")